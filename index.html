<!doctype html>
<html lang="fr-FR">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="stylesheet" href="assets/style.css">
    <meta name="description" content="">

    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <meta property="og:image:alt" content="">

    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="icon.png">

    <link rel="manifest" href="site.webmanifest">
    <meta name="theme-color" content="#fafafa">
</head>

<body>
    <header class="quarters js-quarters">
        <button type="button" class="btn-quarter is-active" data-quarter-id="0">Q1</button>
        <button type="button" class="btn-quarter" data-quarter-id="1">Q2</button>
        <button type="button" class="btn-quarter" data-quarter-id="2">Q3</button>
        <button type="button" class="btn-quarter" data-quarter-id="3">Q4</button>
        <button type="button" class="btn-reset btn-stats js-stats">
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M2 21v-2h20v2zm1-3v-7h3v7zm5 0V6h3v12zm5 0V9h3v9zm5 0V3h3v15z"/></svg>
        </button>
    </header>
    <aside>
        <dialog>
            <div class="dialog-header">
                <h1 class="dialog-title">Statistiques</h1>
                <button type="button" class="btn-reset" onclick="this.parentElement.close()"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M6.4 19L5 17.6l5.6-5.6L5 6.4L6.4 5l5.6 5.6L17.6 5L19 6.4L13.4 12l5.6 5.6l-1.4 1.4l-5.6-5.6z"/></svg></button>
            </div>
            <table border="1">
                <thead>
                    <tr>
                        <th></th>
                        <th>Q1</th>
                        <th>Q2</th>
                        <th>Q3</th>
                        <th>Q4</th>
                        <th>Temps total</th>
                    </tr>
                </thead>
                <tbody class="js-table"></tbody>
            </table>
        </dialog>
    </aside>
    <main class="js-main"></main>
    <footer>
        <button type="button" class="js-launch-timer">
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M9 3V1h6v2zm3 19q-1.85 0-3.488-.712T5.65 19.35t-1.937-2.863T3 13t.713-3.488T5.65 6.65t2.863-1.937T12 4q1.55 0 2.975.5t2.675 1.45l1.4-1.4l1.4 1.4l-1.4 1.4Q20 8.6 20.5 10.025T21 13q0 1.85-.713 3.488T18.35 19.35t-2.863 1.938T12 22m0-2q2.9 0 4.95-2.05T19 13t-2.05-4.95T12 6T7.05 8.05T5 13t2.05 4.95T12 20m-2-3l6-4l-6-4z"/></svg>
        </button>
        <button type="button" class="js-pause-timer" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22q-1.875 0-3.512-.712t-2.85-1.925t-1.925-2.85T3 13t.713-3.512t1.924-2.85t2.85-1.925T12 4t3.513.713t2.85 1.925t1.925 2.85T21 13t-.712 3.513t-1.925 2.85t-2.85 1.925T12 22M5.6 2.35L7 3.75L2.75 8l-1.4-1.4zm12.8 0l4.25 4.25l-1.4 1.4L17 3.75zM12 20q2.925 0 4.963-2.037T19 13t-2.037-4.962T12 6T7.038 8.038T5 13t2.038 4.963T12 20m-3-3h2V9H9zm4 0h2V9h-2z"/></svg>
        </button>
    </footer>
    <template id="template-cell">
        <div class="cell js-cell">
            <input type="text" class="name js-name" aria-label="PrÃ©nom" autocomplete="off" data-lpignore="true" data-form-type="other" />
            <p class="timer js-timer">
                0:00:00
            </p>
            <div class="addtimes js-addtimes">
                <button type="button" data-increment="-1">-1s</button>
                <button type="button" data-increment="+1">+1s</button>
            </div>
            <div class="timer-control">
                <label class="timer-toggle">
                    <input type="checkbox" class="js-playeronfield">
                    Sur le terrain
                </label>
                <button type="button" class="js-button-reset"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M7 21q-.825 0-1.412-.587T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413T17 21zm2-4h2V8H9zm4 0h2V8h-2z"/></svg></button>
            </div>
        </div>
    </template>
    <script type="module">
        import { Timer } from './assets/timer.js'

        window.is_timer_started = false

        const TEMPLATE = document.querySelector('#template-cell')
        const MAINELEMENT = document.querySelector('.js-main')
        const TIMERS = new Map()
        const PLAYBUTTON = document.querySelector('.js-launch-timer')
        const PAUSEBUTTON = document.querySelector('.js-pause-timer')
        const QUARTERSWRAPPERELEMENT = document.querySelector('.js-quarters')
        const NAMES = ['Rosemary Palmer', 'Theo Rosales', 'Kinley Pearson', 'Gunner Ponce', 'Aileen Villanueva', 'Huxley Good', 'Nathalia Dyer', 'Atreus Camacho', 'Armani Benjamin', 'Kyro Rogers']
        const TABLE = document.querySelector('.js-table')
        const DIALOG = document.querySelector('dialog')

        Array.from({ length: 10 }).forEach(() => {
            const content = TEMPLATE.content.cloneNode(true)
            MAINELEMENT.appendChild(content)
        })

        document.querySelectorAll('.js-cell').forEach((element, index) => {
            element.querySelector('.js-name').value = NAMES[index]
            const launchTimer = new Timer(element)
            TIMERS.set(element.id, launchTimer)
        })

        PLAYBUTTON.addEventListener('click', ({ target }) => {
            target.hidden = true
            PAUSEBUTTON.hidden = false
            window.is_timer_started = true
            TIMERS.forEach((timer) => {
                timer.start()
            })
        })

        PAUSEBUTTON.addEventListener('click', ({ target }) => {
            window.is_timer_started = false
            target.hidden = true
            PLAYBUTTON.hidden = false
            TIMERS.forEach((timer) => {
                timer.pause()
            })
        })

        QUARTERSWRAPPERELEMENT.addEventListener('click', ({ target }) => {
            if (!target.dataset.quarterId) {
                return
            }
            QUARTERSWRAPPERELEMENT.querySelector('.is-active')?.classList.remove('is-active')
            target.classList.add('is-active')
            PLAYBUTTON.hidden = false
            PAUSEBUTTON.hidden = true
            TIMERS.forEach((timer) => {
                timer.quarter = Number(target.dataset.quarterId)
                timer.updateFromQuarter()
            })
        })

        document.querySelector('.js-stats')?.addEventListener('click', () => {
            TABLE.replaceChildren('')
            TIMERS.forEach((timer, id) => {
                let cumuled = 0
                const cellTimerElement = document.getElementById(id);
                const rowElement = document.createElement('tr')
                const cellNameElement = document.createElement('td')
                cellNameElement.innerText = cellTimerElement.querySelector('.js-name').value
                rowElement.appendChild(cellNameElement)
                Array.from({ length: 4 }).forEach((value, index) => {
                    cumuled = cumuled + timer.duration[index]
                    const cellTimeElement = document.createElement('td')
                    cellTimeElement.innerText = timer.format(timer.duration[index])
                    rowElement.appendChild(cellTimeElement)
                })
                const cumuledCellElement = document.createElement('td')
                cumuledCellElement.innerText = timer.format(cumuled)
                rowElement.appendChild(cumuledCellElement)
                TABLE.appendChild(rowElement)
            })
            DIALOG.showModal()
        })



    </script>
</body>

</html>
